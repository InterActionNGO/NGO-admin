<%= render 'new_partials/map' %>

<%= render 'new_partials/categories_selector' %>

<div class="row">
  <aside>
    <div class="grid-4">
      <% unless @filter_by_location.present? %>
        <%= render 'new_partials/aside/projects' %>
      <% end %>

      <% if @site.navigate_by_country %>
        <%= render 'new_partials/aside/countries' %>
      <% else %>
        <%= render 'new_partials/aside/regions' %>
      <% end %>

      <% unless @filter_by_organization.present? %>
        <%= render 'new_partials/aside/affiliated_organizations' %>
      <% end %>

      <% unless @filter_by_location.present? || @donor_projects_by_location.empty? %>
        <%= render 'new_partials/aside/project_locations' %>
      <% end %>

      <% unless @site.nil? || @filter_by_category.present? || @donor_projects_clusters_sectors.empty? %>
        <%= render 'new_partials/aside/project_sectors' %>
      <% end %>

      <% if @contact_data[:show] %>
        <%= render 'new_partials/aside/contact_info' %>
      <% end %>

      <% unless @donor.twitter.blank? && @donor.facebook.blank? && @donor.website.blank? %>
        <%= render 'new_partials/aside/follow_us' %>
      <%end%>
    </div>
  </aside>

  <section class="content">
    <div class="grid-12 offset-1">
      <h1 class="section-title"><%= @donor.name.html_safe %></h1>

      <%= render :partial => 'new_partials/downloads', :locals => { :csv_path => donor_path(@donor, @carry_on_filters.merge(:format => :csv)), :xls_path => donor_path(@donor, @carry_on_filters.merge(:format => :xls)), :kml_path => donor_path(@donor, @carry_on_filters.merge(:format => :kml)) } %>

      <div class="articles-list">
        <% unless @projects.empty? %>
          <ul>
            <% @projects.each_with_index do |project,index| %>
              <li>
                <article class="mod-index-item">
                  <h2><%= link_to(truncate(project['project_name'], :length=>65), project_path(project['project_id'])) %></h2>
                  <span>
                    <%= subtitle_donors_page(project, @site, donor_path( params[:id], @carry_on_filters.merge(:organization_id => project["organization_id"].to_i) ) ) %>
                  </span>
                  <p>
                    <%= anglo(truncate(project['project_description'], :length => 175, :omission => "... <a href=\"#{project_path(project['project_id'])}\" class=\"learn_more\">Learn more</a>")) %>
                  </p>
                </article>
              </li>
            <% end %>
          </ul>
        <% else %>
          <ul>
            <li>
              <article class="mod-index-item">
                <p class="no_results">No projects were found for this donor</p>
              </article>
            </li>
          </ul>
        <% end %>
      </div>

    </div>
  </section>
</div>
