<link rel="Stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/ui-darkness/jquery-ui.css" type="text/css" />

<%= form_for(@project, :url => (@project.new_record? ? admin_projects_path : admin_project_path(@project))) do |f| %>

  <div class="field">
    <label>PROJECT NAME  <strong>*</strong></label>
    <span class="input_large <%= 'error' if !@project.errors[:name].empty? && action_name != 'new' %>">
        <%= f.text_field :name, :class=>"long #{'error' if !@project.errors[:name].empty? && action_name != 'new'}" %>
        <%= errors_for @project, :name %>
    </span>
  </div>
  <div class="field">
    <label>DESCRIPTION  <strong>*</strong></label>
    <span class="textarea <%= 'error' if !@project.errors[:description].empty? && action_name != 'new' %>">
        <%= f.text_area :description, :class => "#{'error' if !@project.errors[:description].empty? && action_name != 'new'}" %>
    </span>
  </div>
  <div class="field">
    <p class="title">TAGS <span class="info">Use comma (",") to separate project tags</span></p>
    <span id="tags_combo" class="input_large">
      <%= f.text_field :tags, :value => @project.tags.map{ |tag| tag.name }.join(', ') %>
    </span>
  </div>
  <div class="field">
    <label>ORGANIZATION  <strong>*</strong></label>

    <div class="list_combo">
        <span id="hidden" class="combo_large">
          <%= errors_for_span(@project, :primary_organization) %>
        <a class="organization"><%= Organization.first.name %></a>
      </span>
      <%= f.hidden_field :primary_organization_id , :value => Organization.first.id %>
      <ul class="list_combo_content">
        <li class="first"></li>
          <% Organization.all.each do |organization| %>
            <li class="element" id="<%= organization.id %>"><p class="project_name"><%= organization.name %></p><p class="amount_projects"><%= pluralize(organization.projects.count, 'project', 'projects')%></p></li>
          <% end -%>
        <li class="last"></li>
      </ul>
    </div>
  </div>
  <div class="field">
    <label>IMPLEMENTING ORGANIZATION</label>
    <span class="input_large">
      <%= f.text_field :implementing_organization %>
    </span>
  </div>
  <div class="field">
    <label>PARTNER ORGANIZATIONS</label>
    <span class="input_large">
      <%= f.text_field :partner_organizations %>
    </span>
  </div> <!-- field -->
  <div class="field">
    <label>CROSS-CUTTING ISSUES</label>
    <span class="input_large">
      <%= f.text_field :cross_cutting_issues %>
    </span>
  </div>
  <div class="field">
    <label>ACTIVITIES</label>
    <span class="textarea">
      <%= f.text_area :activities %>
    </span>
  </div>
  <!-- SECTION  -->
  <h3 class="section">PROJECT MANAGEMENT</h3>
  <div class="field">
    <label>INTERVENTION ID</label>
    <span class="input_large">
      <%= f.text_field :intervention_id %>
    </span>
  </div>
  <div class="field">
    <label>ADDITIONAL INFORMATION</label>
    <span class="textarea">
      <%= f.text_area :additional_information %>
    </span>
  </div>
  <div class="field">
    <label>AWARDEE TYPE</label>
    <span class="input_large">
      <%= f.text_field :awardee_type %>
    </span>
    <ul class="dates">
      <li class="date">
        <label>DATE PROVIDED</label>

        <span id="date_provided" class="combo_date"><p>09/10/2010</p>
        <div class="select_dates">
          <p id="month" class="title">MONTH</p>
          <p id="day" class="title">DAY</p>
          <p id="year" class="title">YEAR</p>

         <%= f.date_select :date_provided, :start_year => Date.today.year - 5, :order => [:month, :day, :year]  %>

          <a class="save_date_bttn provided">Save date</a>
        </div>
        </span>
      </li>
      <li class="date">
        <label>DATE UPDATED</label>
        
        <span id="date_updated" class="combo_date"><p>09/10/2010</p>
        <div class="select_dates end_date">
          <p id="month" class="title">MONTH</p>
          <p id="day" class="title">DAY</p>
          <p id="year" class="title">YEAR</p>

            <%= f.date_select :date_updated, :start_year => Date.today.year - 5, :order => [:month, :day, :year]  %>

          <a class="save_date_bttn updated">Save date</a>
        </div>
     </span>
      </li>
    </ul>
  </div>
  <!-- SECTION  -->
  <h3 class="section">CONTEXT</h3>

  <div class="field">
    <label>CLUSTERS  <strong>*</strong></label>
    <ul class="clusters">
      <% unless @project.clusters.empty? %>
            <% @project.clusters.each do |cluster| %>
              <li id="cluster_<%= cluster.id %>"><%= cluster.name %><input id="<%= cluster.id %>" type="checkbox" name="project[clusters_ids][]" value="<%= cluster.id %>" checked="true"/><a href="#cluster_<%= cluster.id %>" class="remove_this close"></a>
          </li>
            <% end -%>
        <% end -%>
    </ul>

    <div class="cluster_options">
      <span class="combo_cluster_options">
        <%= errors_for_span(@project, :clusters) %>

        <p id="0">Select more clusters</p>
        <ul class="options">
        <% Cluster.all.collect do |cluster| %>
          <li><a id="<%= cluster.id %>"><%= cluster.name %></a></li>
        <% end %>
          <li class="last"></li>
        </ul>
      </span>
      <a id="add_cluster_bttn" class="add_cluster">add cluster</a>
    </div>
  </div>

  <div class="field">
    <label>SECTORS  <strong>*</strong></label>

    <ul class="sectors">
      <% unless @project.sectors.empty? %>
            <% @project.sectors.each do |sector| %>
          <li id="sector_<%= sector.id %>"><%= sector.name %><input id="<%= sector.id %>" type="checkbox" name="project[sectors_ids][]" value="<%= sector.id %>" checked="true"/><a href="#sector_<%= sector.id %>" class="remove_this close"></a>
          </li>
      <% end -%>
        <% end -%>
    </ul>

    <div class="sector_options">
      <span id="sector" class="combo_sector_options">
        <%= errors_for_span(@project, :sectors) %>

      <p id="0">Select more sectors</p>
      <ul class="options">
      <% Sector.all.collect do |sector| %>
        <li><a id="<%= sector.id %>"><%= sector.name %></a></li>
      <% end %>
        <li class="last"></li>
      </ul>

    </span>
      <a class="add_sector">add sector</a>
    </div>
  </div>

  <!-- ************************ FALTA ************************ -->
  <label>GEOGRAPHIC UBICATION  <strong>*</strong></label>
  <ul class="ubications">
    <li>Bellad√®re, Haiti<a class="close"></a></li>
    <li>Martinique, Haiti<a class="close"></a></li>
  </ul>
  <div class="location_options empty">
    <p class="msg">Add / edit the different locations of the project</p>
    <a class="add_location" id="add_location_map">add location</a>
  </div>
  <!-- ************************ FIN FALTA ************************ -->

  <div class="field">
    <ul class="dates">
      <li class="date">
        <label>START DATE</label>
        <span id="start_date" class="combo_date"><p>09/10/2010</p>
          <div class="select_dates start_date">
            <p id="month" class="title">MONTH</p>
            <p id="day" class="title">DAY</p>
            <p id="year" class="title">YEAR</p>

              <%= f.date_select :start_date, :start_year => Date.today.year - 5, :order => [:month, :day, :year]  %>

            <a class="save_date_bttn start">Save date</a>
          </div>
        </span>
      </li>
      <li class="date">
        <label>END DATE</label>
        
        <span id="end_date" class="combo_date"><p>09/10/2010</p>
          <div class="select_dates end_date">
            <p id="month" class="title">MONTH</p>
            <p id="day" class="title">DAY</p>
            <p id="year" class="title">YEAR</p>

              <%= f.date_select :end_date, :start_year => Date.today.year - 5, :order => [:month, :day, :year]  %>

            <a class="save_date_bttn end">Save date</a>
          </div>
        </span>
      </li>
    </ul>
  </div>
  <!-- SECTION  -->
  <h3 class="section">IMPACT</h3>


  <label>PROJECT BUDGET</label>
  <div class="field">
    <span class="input_short coin">
      <%= f.text_field :budget %>
      <p class="coin">$</p>
    </span>
  </div>
  <div class="two_columns">
    <div class="left_column">
      <div class="field">
        <label>TARGET</label>
        <span class="input_short">
          <%= f.text_field :target %>
        </span>
      </div>
    </div>
    <div class="right_column">
       <div class="field">
          <label>ESTIMATED PEOPLE REACHED</label>
          <span class="input_short">
            <%= f.text_field :estimated_people_reached %>
            <p class="msg">people</p>
          </span>
        </div>
    </div>
  </div>

  <!-- SECTION  -->
  <h3 class="section">CONTACT INFORMATION</h3>
  <div class="field">
    <label>CONTACT PERSON</label>
    <span class="input_short">
        <%= f.text_field :contact_person %>
    </span>
  </div>

  <div class="two_columns">
    <div class="left_column">
      <div class="field">
        <label>CONTACT EMAIL</label>
        <span class="input_short">
          <%= f.text_field :contact_email %>
        </span>
      </div>
    </div>
    <div class="right_column">
      <div class="field">
        <p class="title">CONTACT PHONE <span class="info">Include international prefix</span></p>
        <span class="input_short">
          <%= f.text_field :contact_phone_number %>
        </span>
      </div> <!-- field -->
    </div>
  </div>

  <%= f.submit '', :class => "#{'error' if @project.invalid? && action_name != 'new'}" %>
  <!-- END EDIT PAGE -->

<%end%>

  <div class="map_window">
    <a class="close">Close</a>
    <h3 class="museo_sans">Geolocate this project</h3>
    <div class="outer_map">
      <form class="geocoder" action="javascript:void searchPlace()">
        <input type="text" value="Location, latitude or longitude" />
        <input type="submit" />
      </form>
      <div id="map"></div>
    </div>
    <p>You can click multiple points to add<br/>several locations to the project</p>
    <a class="save">save position</a>
  </div>


<script type="text/javascript">
$(function() {
  function split( val ) {
    return val.split( /,\s*/ );
  }
  $("#project_tags").autocomplete({
    source: function( request, response ) {
    $('span#tags_combo').addClass('active');
      var value = $("#project_tags").val();
      if (value.indexOf(',') != -1 ) {
        value = value.substring(value.indexOf(',')+1, value.length);
      }
      $.ajax({
        url: '<%= admin_tags_path %>?term=' + value,
        dataType: "json",
        success: function( data ) {
          if(data != null) {
            response($.map(data, function(tag) {
              return {
                label: tag.name + ' ' + tag.count + ' projects',
                value: tag.name
              }
            }));
          }
        }
      });
    },
    minLength: 2,
    focus: function() {
      // prevent value inserted on focus
      return false;
    },
    select: function( event, ui ) {
      var terms = split( this.value );
      // remove the current input
      terms.pop();
      // add the selected item
      terms.push( ui.item.value );
      // add placeholder to get the comma-and-space at the end
      terms.push( "" );
      this.value = terms.join( ", " );

      return false;
    },
    refresh: function(){
       this.element.children("li.ui-menu-item:odd a").addClass("ui-menu-item-alternate");
    }
  });

  // X
  // $('.remove_this').live('click',function(){
  //   $($(this).attr('href')).children().each(function(){
  //     $(this).remove();
  //   });
  //   $($(this).attr('href')).remove();
  // });

  // ADD CLUSTER
  // $('#select_cluster').change(function(){
  //    var str = ""
  //    $("select#select_cluster option:selected").each(function () {
  //          str += $(this).text() + " ";
  //        });
  //    $('#clusters').append('<span id="cluster_'+$(this).val()+'"><input type="checkbox" name="project[clusters_ids][]" value="' +$(this).val() +'" checked="checked"/>' + str + ' <a href="#cluster_'+$(this).val()+'" class="remove_this">x</a><br /></span>');
  //  });
  //
  //
  //  $('#select_sector').change(function(){
  //    var str = ""
  //    $("select#select_sector option:selected").each(function () {
  //          str += $(this).text() + " ";
  //        });
  //    $('#sectors').append('<span id="sector_'+$(this).val()+'"><input type="checkbox" name="project[sectors_ids][]" value="' +$(this).val() +'" checked="checked"/>' + str + ' <a href="#sector_'+$(this).val()+'" class="remove_this">x</a><br /></span>');
  //  });
});
</script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script src="/javascripts/backoffice/project_map.js" type="text/javascript" charset="utf-8"></script>
  <script src="/javascripts/plugins/jquery.stylish-select.js" type="text/javascript" charset="utf-8"></script>
