
  <div id="layout">
    <div id="pages">
      <div class="left"></div>
      <div class="float_left">
        <div class="outer_head">
          <div class="head">
            <h1>Search projects</h1>
            <%= form_tag(search_path, :method => :get) do %>
              <%= text_field_tag :q, params[:q] %>
              <%= submit_tag 'Search' %>
            <% end %>
          </div>
        </div>
        <div class="results_list">

          <h3><p>
            <%= pluralize(@projects.count, 'project') %> for '<%= params[:q] %>'
            <%= raw("in #{link_to(@cluster.name, remove_filter_url(:cluster_id))} CLUSTER") if @cluster %>
            <%= raw("in region #{link_to(@region.name, remove_filter_url(:region_id))}") if @region %>
          </p></h3>
          <% if @projects && @projects.any? %>
            <ul>
              <% @projects.each_with_index do |project,index| %>
                <li class="<%= cycle('even', 'odd') %>">
                  <div class="project_name">
                    <h3><%= link_to(truncate(project.name,:length=>43,:omission=>"..."), project_path(project)) %></h3>
                    <p>by <%= link_to(project.primary_organization.name, organization_path(project.primary_organization)) %></p>
                  </div>
                  <div class="project_places">
                    <p>Mexico, Spain, United Kingdom and 3 more</p>
                  </div>
                </li>
              <% end %>
            </ul>
            <%= will_paginate(@projects) %>
          <% else %>
            <% unless params[:q].blank? %>
              <ul>
                <li class="even">
                  <p class="no_results">No projects were found for '<%= params[:q] %>'</p>
                </li>
              </ul>
            <% end %>
          <% end %>
        </div>
      </div>
      <div class="right">
        <div class="block">
          <% if @regions && @regions.any? %>
            <h2>Filter by region</h2>
            <ul class="filter_list">
            <% index = 0 %>
            <% @regions.each do |region, count| %>
              <% if index<9 %>
                <% if params[:region_id] && params[:region_id].to_i == region.id %>
                  <li><%= region.name %></li>
                <% else %>
                  <li><%= link_to(region.name, search_path(:q => params[:q], :region_id => region.id)) %> (<%= count %>)</li>
                <% end %>
              <% else %>
                <li><%= link_to(region.name, filter_url(region)) %> (<%= count %>)</li>
              <% end %>
              <% index = index + 1 %>
            <% end %>
            </ul>
            <% if @regions.size>10 %>
              <a href="#more_results" class="more">More results</a>
            <% end %>
          <% end %>
        </div>

        <div class="block">
          <% if @clusters && @clusters.any? %>
            <h2>Filter by TOP <%= @site.word_for_clusters %></h2>
            <ul class="filter_list">
            <% index = 0 %>
            <% @clusters.each do |cluster, count| %>
              <% if index<9 %>
                <% if params[:cluster_id] && params[:cluster_id].to_i == cluster.id %>
                  <li><%= cluster.name %></li>
                <% else %>
                  <li><%= link_to(cluster.name, search_path(:q => params[:q], :cluster_id => cluster.id)) %> (<%= count %>)</li>
                <% end %>
              <% else %>
                <li><%= link_to(cluster.name, filter_url(cluster)) %> (<%= count %>)</li>
              <% end %>
              <% index = index + 1 %>
            <% end %>
            </ul>
            <% if @clusters.size>10 %>
              <a href="#more_results" class="more">More results</a>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <script src="/javascripts/sites/pages.js" type="text/javascript" charset="utf-8"></script>

