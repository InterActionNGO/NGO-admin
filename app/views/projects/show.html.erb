<%= render 'new_partials/map' %>

<%= render 'new_partials/categories_selector' %>

<% content_for :js_vars do %>
  <script>
    <% if @site.overview_map_lat && @site.overview_map_lon %>
    var map_center = [<%= @site.overview_map_lat %>, <%= @site.overview_map_lon %>];
    <% else %>
    var map_center = [];
    <% end %>
    var map_zoom = <%= @site.overview_map_zoom %>;
    var chco = '<%= @overview_map_chco %>';
    var chf = '<%= @overview_map_chf %>';
    var chld = '<%= @chld %>';
    var chd = '<%= @chd %>';
    var map_data = <%=raw(@map_data)%>;
    var max_count = <%=@map_data_max_count%>;
    var map_type = 'project_map';
    var theme = "<%= @site.theme_id %>";
    var kind = window.location.pathname.split('/')[1];
    var stylez = <%=raw @site.map_styles  %>
    var empty_layer = <%= @empty_layer.present?? @empty_layer : false %>;
  </script>
<% end %>

<div class="row">
  <div class="grid-4">
    <aside class="layout-sidebar">

      <% unless ((@project.contact_person.nil? || @project.contact_person.empty?) && (@project.contact_position.nil? || @project.contact_position.empty?)&& (@project.contact_phone_number.nil? || @project.contact_phone_number.empty?) && (@project.contact_email.nil?||@project.contact_email.empty?)) %>
        <div class="contact-info mod-info">

            <h3>Contact information</h3>

            <div class="mod-contact-info">
              <h4><%= @project.contact_person %></h4>
              <p><%= @project.contact_position %></p>
              <p><%= @project.contact_phone_number %></p>
              <% unless (@project.contact_email.nil?)||(@project.contact_email.empty?) %>
                <p><%= link_to(@project.contact_email, "mailto:#{@project.contact_email}") %></p>
              <%end%>
            </div>
        </div>
      <% end %>

      <div class="mod-downloads mod-info">
        <h3>Export data</h3>
        <ul>
          <li><%= link_to 'CSV', project_path(@project, :csv), :class => 'csv' %></li>
          <li><%= link_to 'XLS', project_path(@project, :xls), :class => 'xls' %></li>
          <li><%= link_to 'KML', project_path(@project, :kml), :class => 'kml' %></li>
        </ul>
      </div>

    </aside>
  </div>

  <div class="grid-12 offset-1">
    <section class="layout-content" id="content">

      <article class="mod-content-article">
        <h1><%= @project.name %></h1>

        <% unless @project.description.blank? %>
          <section>
            <h2>Project description</h2>
            <%= anglo(simple_format(@project.description)) %>
          </section>
        <% end %>

        <% if @project.activities || @project.additional_information || @project.cross_cutting_issues || (@locations.present? && @locations.to_a.join.present?)%>
          <section>
            <%unless @project.activities.blank? %>
              <h2>Activities</h2>
              <p> <%= raw(@project.activities) %> </p>
            <%end%>
            <%unless @project.additional_information.blank? %>
              <h3 class="<%= (@project.activities.blank?)? 'first':''%>">Additional information</h3>
              <p> <%= raw(@project.additional_information) %> </p>
            <%end%>
            </section>

            <section>
            <%unless @project.cross_cutting_issues.blank? %>
              <h2 class="<%= (@project.activities.blank? && @project.additional_information.blank?)? 'first':''%>">Cross-cutting issues</h2>
              <p> <%= raw(@project.cross_cutting_issues) %> </p>
            <%end%>
          </section>

          <section>
            <%if @locations.present? && @locations.to_a.join.present? %>
              <h2 class="<%= (@project.activities.blank? && @project.additional_information.blank? && @project.cross_cutting_issues.blank?)? 'first':''%>">
                <%= @locations.count == 1 ? 'Location' : 'Locations' %>
              </h2>
              <ul>
                <% @locations.each do |location| %>
                  <% if @site.navigate_by_country? && location['country_id'].present? %>
                    <li><%= location['name'] %>, <%= Country.find(location['country_id'], :select => 'name').name %></li>
                  <% else %>
                    <li><%= location['name'] %></li>
                  <% end %>
                <% end %>
              </ul>
            <%end%>
          </section>
        <% end %>

        <%= render 'new_partials/more_projects' %>

      </div>
    </article>

  </section>
</div>
