(function($){var self=null;$.fn.liveUpdate=function(list){return this.each(function(){new $.liveUpdate(this,list);});};$.liveUpdate=function(e,list){this.field=$(e);this.list=$('#'+list);if(this.list.length>0){this.init();}};$.liveUpdate.prototype={init:function(){var self=this;this.setupCache();this.field.parents('form').submit(function(){return false;});this.field.keyup(function(){self.filter();});self.filter();},filter:function(){if($.trim(this.field.val())==''){this.list.find('li').children('a').show();return;}
this.displayResults(this.getScores(this.field.val().toLowerCase()));},setupCache:function(){var self=this;this.cache=[];this.rows=[];this.list.find('li').each(function(){self.cache.push(this.innerHTML.toLowerCase());self.rows.push($(this));});this.cache_length=this.cache.length;},displayResults:function(scores){var self=this;this.list.find('li').hide();$.each(scores,function(i,score){self.rows[score[1]].show();});var element=this.list;if(element.length>0){var api=element.data('jsp');api.reinitialise();}else{this.list.find('p.no_founded').css('display','inline');}
if(scores.length>0){this.list.find('p.no_founded').css('display','none');}else{this.list.find('p.no_founded').css('display','inline');}},getScores:function(term){var scores=[];for(var i=0;i<this.cache_length;i++){var score=this.cache[i].contains(term);if(score>0){scores.push([score,i]);}}
return scores.sort(function(a,b){return b[0]-a[0];});}}})(jQuery);jQuery(function($){var csrf_token=$('meta[name=csrf-token]').attr('content'),csrf_param=$('meta[name=csrf-param]').attr('content');$.fn.extend({triggerAndReturn:function(name,data){var event=new $.Event(name);this.trigger(event,data);return event.result!==false;},callRemote:function(){var el=this,method=el.attr('method')||el.attr('data-method')||'GET',url=el.attr('action')||el.attr('href'),dataType=el.attr('data-type')||'script';if(url===undefined){throw"No URL specified for remote call (action or href must be present).";}else{if(el.triggerAndReturn('ajax:before')){var data=el.is('form')?el.serializeArray():[];$.ajax({url:url,data:data,dataType:dataType,type:method.toUpperCase(),beforeSend:function(xhr){el.trigger('ajax:loading',xhr);},success:function(data,status,xhr){el.trigger('ajax:success',[data,status,xhr]);},complete:function(xhr){el.trigger('ajax:complete',xhr);},error:function(xhr,status,error){el.trigger('ajax:failure',[xhr,status,error]);}});}
el.trigger('ajax:after');}}});$('a[data-confirm],input[data-confirm]').live('click',function(){var el=$(this);if(el.triggerAndReturn('confirm')){if(!confirm(el.attr('data-confirm'))){return false;}}});$('form[data-remote]').live('submit',function(e){$(this).callRemote();e.preventDefault();});$('a[data-remote],input[data-remote]').live('click',function(e){$(this).callRemote();e.preventDefault();});if(!$.browser.msie){$('a[data-method]:not([data-remote])').live('click',function(e){var link=$(this),href=link.attr('href'),method=link.attr('data-method'),form=$('<form method="post" action="'+href+'"></form>'),metadata_input='<input name="_method" value="'+method+'" type="hidden" />';if(csrf_param!=null&&csrf_token!=null){metadata_input+='<input name="'+csrf_param+'" value="'+csrf_token+'" type="hidden" />';}
form.hide().append(metadata_input).appendTo('body');e.preventDefault();form.submit();});};var disable_with_input_selector='input[data-disable-with]';var disable_with_form_selector='form[data-remote]:has('+disable_with_input_selector+')';$(disable_with_form_selector).live('ajax:before',function(){$(this).find(disable_with_input_selector).each(function(){var input=$(this);input.data('enable-with',input.val()).attr('value',input.attr('data-disable-with')).attr('disabled','disabled');});});$(disable_with_form_selector).live('ajax:complete',function(){$(this).find(disable_with_input_selector).each(function(){var input=$(this);input.removeAttr('disabled').val(input.data('enable-with'));});});});IOM={ajax_pagination:function(){$('a.ajax').attr('data-remote','true');}}
if($.browser.msie){$('div#header ul.menu li#cluster_option a:eq(0)').css('width','70px');$('div#header ul.menu li#country_option a:eq(0)').css('width','70px');$('div#header ul.menu li#region_option a:eq(0)').css('width','65px');$('div#header ul.menu li#organization_option a:eq(0)').css('width','110px');$('div#header ul.menu li#donor_option a:eq(0)').css('width','110px');}
function projectClustersWidth(){var $el=$('#clustersWidth'),$items=$el.find('a'),w=$el.width(),values=[],max=$($items[0]).data('value');for(var i=0,len=$items.length;i<len;i++){var item=$($items[i]);var value=item.attr('data-value');var itemWidth=(value/max)*(w-22);if(itemWidth-30>0){item.find('.aller').css('width',itemWidth+'px');}else{item.find('.aller').css('width',itemWidth+10+'px');}}}
$(document).ready(function(){projectClustersWidth();$("a#see_all").hover(function(){var position=$(this).position();$(this).parent().children('div.tooltip').css('top',position.top-65+'px');$(this).parent().children('div.tooltip').css('left',position.left-23+'px');$(this).parent().children('div.tooltip').show();},function(){$(this).parent().children('div.tooltip').hide();});$("a#see_all").click(function(ev){ev.preventDefault();ev.stopPropagation();});if($('.scroll_pane_auto').length>0){$('.scroll_pane_auto').jScrollPane({autoReinitialise:true});}
$('#ngos_search').val('');if(document.getElementById('orgs_list')){$('#ngos_search').liveUpdate('orgs_list');}
$('#dgos_search').val('');if(document.getElementById('donors_list_menu')){$('#dgos_search').liveUpdate('donors_list_menu');}
if($('.scroll_pane').length>0){$('.scroll_pane').jScrollPane({autoReinitialise:false});}
if($('span.input_search input').val()==''){$('span.input_search label').show();};$('span.input_search input').focusin(function(ev){$(this).prev('label').fadeOut();});$('span.input_search input').focusout(function(ev){var value=$(this).attr('value');if(value==""){$(this).prev('label').fadeIn();}});$('ul.statistics_list li a').hover(function(ev){ev.stopPropagation();ev.preventDefault();$(this).parent().children('div.tooltip').show();},function(){$(this).parent().children('div.tooltip').hide();});$('ul.menu li a.main_option.with_suboptions').click(function(ev){ev.stopPropagation();ev.preventDefault();if(($(this).children('span.with_suboptions').length>0)&&(!$(this).hasClass('displayed'))){$('ul.menu li a.displayed').removeClass('displayed');$('ul.menu li.clicked').removeClass('clicked');$(this).addClass('displayed');$(this).parent().addClass('clicked');if($(this).parent().find('.scroll_pane').length>0){resetCombo($(this).parent());}
if($(this).parent().find('input#ngos_search').length>0){$(this).parent().find('input#ngos_search').focus();}
if($(this).parent().find('input#dgos_search').length>0){$(this).parent().find('input#dgos_search').focus();}
$(document).click(function(event){if((!$(event.target).closest('ul.suboptions li a').length)&&(!$(event.target).closest('ul.scroll_pane').length)&&(!$(event.target).closest('input#ngos_search').length)&&(!$(event.target).closest('input#dgos_search').length)){$('ul.menu li.clicked').removeClass('clicked');$('ul.menu li a.displayed').removeClass('displayed');};});}
else{$('ul.menu li a.displayed').removeClass('displayed');}});IOM.ajax_pagination();setupEmbedMapPopup();});function resetCombo(elementToUpdate){var element=elementToUpdate.find('.scroll_pane');if(element.length>0){if(element.attr('id')==$('ul#regions').attr('id')){var maxHeight=element.css('max-height');element.css('height',maxHeight);console.log(element);}
var api=element.data('jsp');if(api!=undefined)api.reinitialise();}}
function setupEmbedMapPopup(){$('#embed_map').click(function(evt){evt.preventDefault();$('#popup.embed_map, .popup_background').fadeIn('fast');});$('.popup_background').click(function(){$('#popup.embed_map, .popup_background').fadeOut('fast');})
$('#popup.embed_map a').click(function(evt){evt.preventDefault();$('#popup.embed_map, .popup_background').fadeOut('fast');});}